<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>72h Clock Week Scheduler</title>
<style>
    body { font-family: 'Segoe UI', sans-serif; margin: 20px; background-color: #121212; color: #eee; }
    h1, h3 { color: #fff; }
    .scheduler { display: flex; gap: 40px; flex-wrap: wrap; align-items: flex-start; }
    .form { background: #1e1e1e; padding: 20px; border-radius: 12px; box-shadow: 0 0 20px #000; max-width: 350px; flex-shrink:0; }
    .form label { display: block; margin-bottom: 10px; }
    input, select, textarea { width: 100%; padding: 8px; margin-top: 4px; border-radius: 6px; border: none; background: #2c2c2c; color: #eee; box-sizing: border-box; font-size: 16px; }
    button { padding: 12px; border-radius: 8px; border: none; background: #3a86ff; color: #fff; cursor: pointer; margin-top: 10px; width: 100%; box-sizing: border-box; font-size: 16px; }
    button:hover { background: #5aa0ff; }
    .events { max-width: 700px; flex:1; overflow-x: auto; }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 14px; }
    th, td { border: 1px solid #333; padding: 8px; text-align: center; }
    th { background-color: #222; }
    tr:nth-child(even) { background-color: #1b1b1b; }
    .stats { margin-bottom: 20px; background: #1e1e1e; padding: 15px; border-radius: 12px; box-shadow: 0 0 15px #000; font-size: 16px; }
    .importExport { margin-top: 20px; display: flex; flex-direction: column; gap: 8px; }
    .importExport button { width: 100%; display: block; }
    .importExport textarea { margin-top: 8px; resize: vertical; font-size: 14px; }
    td button { padding: 6px 10px; width: auto; background: #ff5f5f; font-size: 14px; }
    td button:hover { background: #ff7f7f; }

    /* --- Responsive --- */
    @media screen and (max-width: 700px) {
        .scheduler { flex-direction: column; gap: 20px; }
        .form, .events { max-width: 100%; }
        table { font-size: 13px; }
        input, select, textarea, button { font-size: 16px; }
    }
    @media screen and (max-width: 400px) {
        input, select, textarea, button { font-size: 15px; padding: 10px; }
        table { font-size: 12px; }
        td button { font-size: 12px; padding: 5px 8px; }
    }
</style>

</head>
<body>

<h1>72h Clock Week Scheduler</h1>

<div class="stats" id="currentStats"></div>

<div class="scheduler">
    <div class="form">
        <h3>Add Task</h3>
        <label>Title:<input type="text" id="eventTitle"></label>

        <label>Input Type:
            <select id="inputType">
                <option value="triplex">72h</option>
                <option value="earth">24h</option>
            </select>
        </label>

        <div id="triplexInputs">
            <label>72h Day (1-7):<input type="number" id="triplexDay" min="1" max="7" value="1"></label>
            <label>72h Time (HH:MM):<input type="text" id="triplexTime" placeholder="HH:MM"></label>
        </div>

        <div id="earthInputs" style="display:none;">
            <label>24h Day (1-21):<input type="number" id="earthDay" min="1" max="21" value="1"></label>
            <label>24h Time (HH:MM):<input type="text" id="earthTime" placeholder="HH:MM"></label>
        </div>

        <button onclick="addEvent()">Add Task</button>

        <div class="importExport">
            <div style="display:flex; gap:4%;">
                <button onclick="exportTasks()">Export Tasks</button>
                <button onclick="importTasks()">Import Tasks</button>
            </div>
            <textarea id="taskText" rows="6" placeholder="Exported/imported tasks appear here..."></textarea>
        </div>
    </div>

    <div class="events">
        <h3>Scheduled Tasks</h3>
        <table>
            <thead>
                <tr>
                    <th>Title</th>
                    <th>72h Time</th>
                    <th>24h Time</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody id="eventTableBody"></tbody>
        </table>
    </div>
</div>

<script>
const TRIPLEX_DAY_HOURS = 72;
const DISPLAY_HOURS = 24;
const TRIPLEX_WEEK_DAYS = 7;
const EARTH_DAYS_PER_WEEK = 21;

// --- Conversion Functions ---
function earthToTriplex(date = new Date()) {
    const localEpoch = new Date(1970,0,1);
    const msSinceEpoch = date - localEpoch;
    const earthHours = msSinceEpoch / 3600000;
    const triplexHour = earthHours % TRIPLEX_DAY_HOURS;
    const displayHourFraction = (triplexHour / TRIPLEX_DAY_HOURS) * DISPLAY_HOURS;
    const hours = Math.floor(displayHourFraction);
    const minutes = Math.floor((displayHourFraction - hours) * 60);
    const seconds = Math.floor((((displayHourFraction - hours) * 60) - minutes) * 60);
    const day = (Math.floor(earthHours / TRIPLEX_DAY_HOURS) % TRIPLEX_WEEK_DAYS) + 1; // 1-7
    return { day, hours, minutes, seconds };
}

function triplexToEarth({ day=1, hours=0, minutes=0, seconds=0 }, referenceDate=new Date()) {
    const localEpoch = new Date(1970,0,1);
    const msSinceEpoch = referenceDate - localEpoch;
    const earthHoursSinceEpoch = msSinceEpoch / 3600000;
    const triplexWeekNumber = Math.floor(earthHoursSinceEpoch / (TRIPLEX_DAY_HOURS * TRIPLEX_WEEK_DAYS));
    const triplexHour = (hours + minutes/60 + seconds/3600)/DISPLAY_HOURS*TRIPLEX_DAY_HOURS;
    const totalEarthHours = triplexWeekNumber*TRIPLEX_DAY_HOURS*TRIPLEX_WEEK_DAYS + (day-1)*TRIPLEX_DAY_HOURS + triplexHour;
    return new Date(localEpoch.getTime() + totalEarthHours*3600000);
}

function formatTime({ hours, minutes, seconds }) {
    return [hours, minutes, seconds].map(n=>n.toString().padStart(2,'0')).join(':');
}

// --- Scheduler ---
let events = [];

// Load from localStorage
function loadEvents() {
    const saved = localStorage.getItem("triplexScheduler");
    if(saved) {
        events = JSON.parse(saved);
        events.forEach(e => e.earthDate = new Date(e.earthDate));
        renderEvents();
    }
}

// Save to localStorage
function saveEvents() { localStorage.setItem("triplexScheduler", JSON.stringify(events)); }

function addEvent() {
    const title = document.getElementById("eventTitle").value.trim();
    if(!title) { alert("Please enter a title."); return; }
    const inputType = document.getElementById("inputType").value;
    let event = null;

    if(inputType === "triplex") {
        const day = parseInt(document.getElementById("triplexDay").value);
        const [hours, minutes] = document.getElementById("triplexTime").value.split(":").map(Number);
        event = { title, day, hours, minutes, seconds:0 };
        event.earthDate = triplexToEarth(event);
        event.earthDay = getEarthDayInWeek(event.earthDate);
    } else {
        const earthDay = parseInt(document.getElementById("earthDay").value);
        const [hours, minutes] = document.getElementById("earthTime").value.split(":").map(Number);
        const startOfWeek = new Date(); startOfWeek.setHours(0,0,0,0);
        const earthDate = new Date(startOfWeek.getTime() + (earthDay-1)*24*3600000 + hours*3600000 + minutes*60000);
        event = { title, earthDate, earthDay, ...earthToTriplex(earthDate) };
    }

    events.push(event);
    saveEvents();
    renderEvents();
}

// Get Earth day in current week
function getEarthDayInWeek(date) {
    const startOfWeek = new Date(); startOfWeek.setHours(0,0,0,0);
    const diffDays = Math.floor((date - startOfWeek)/86400000);
    return ((diffDays % EARTH_DAYS_PER_WEEK) + 1);
}

function renderEvents() {
    const tbody = document.getElementById("eventTableBody");
    tbody.innerHTML = "";
    events.forEach((e,i) => {
        const row = document.createElement("tr");
        const triplexStr = `Day ${e.day} ${formatTime(e)}`;
        const earthStr = `Day ${e.earthDay} ${e.earthDate.toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'})}`;
        row.innerHTML = `<td>${e.title}</td><td>${triplexStr}</td><td>${earthStr}</td>
                         <td><button onclick="removeEvent(${i})">Delete</button></td>`;
        tbody.appendChild(row);
    });
}

function removeEvent(index) {
    events.splice(index,1);
    saveEvents();
    renderEvents();
}

// --- Import / Export ---
function exportTasks() {
    try {
        const txt = JSON.stringify(events, (k, v) => {
            if (k === "earthDate" && v instanceof Date) return v.toISOString();
            return v;
        }, 2);
        const textarea = document.getElementById("taskText");
        textarea.value = txt;
        textarea.select();
        //alert("Tasks exported! You can copy them from the textarea.");
    } catch(e) {
        alert("Error exporting tasks: "+e);
    }
}


function importTasks() {
    const textarea = document.getElementById("taskText");
    const txt = textarea.value.trim();
    if(!txt) { alert("No data to import."); return; }
    try {
        const arr = JSON.parse(txt);
        if(!Array.isArray(arr)) throw new Error("Invalid format");
        arr.forEach(e=>{
            e.earthDate = new Date(e.earthDate);
        });
        events = arr;
        saveEvents();
        renderEvents();
        //alert("Tasks imported successfully!");
    } catch(err) {
        alert("Invalid task data: "+err.message);
    }
}


// --- UI Switching ---
document.getElementById("inputType").addEventListener("change", e=>{
    if(e.target.value === "triplex"){
        document.getElementById("triplexInputs").style.display = "block";
        document.getElementById("earthInputs").style.display = "none";
    } else{
        document.getElementById("triplexInputs").style.display = "none";
        document.getElementById("earthInputs").style.display = "block";
    }
});

// --- Current Stats ---
function updateCurrentStats() {
    const now = new Date();
    const triplex = earthToTriplex(now);
    const earthDay = getEarthDayInWeek(now);
    document.getElementById("currentStats").innerHTML = `
        <strong>Current 72h Time:</strong> Day ${triplex.day} ${formatTime(triplex)}<br>
        <strong>Current 24h Time:</strong> Day ${earthDay} ${now.toLocaleTimeString([], {hour:'2-digit', minute:'2-digit', second:'2-digit'})}
    `;
}

// --- Init ---
setInterval(updateCurrentStats, 1000);
updateCurrentStats();
loadEvents();
</script>

</body>
</html>
